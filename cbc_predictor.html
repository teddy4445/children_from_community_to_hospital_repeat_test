<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  
  <title>
  A Data-driven Guide for Repeated Testing in Pediatric Emergency Departments of Laboratory Testing Previously Performed in the Community
  </title>
  <meta content="Laboratory tests for complete blood count, electrolytes, and C-reactive protein, conducted in the community for children aged three months to 18 years, were analyzed and compared with repeat tests performed in hospitals within 12 hours. The results of these repeated hospital tests were evaluated against the initial community tests. A repeat test was considered justified if there was an absolute change of 10% or more." name="description"/>
  <meta content="Teddy Lazebnik" name="author"/>

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/icofont/icofont.min.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="assets/vendor/animate.css/animate.min.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
  
 </head>
 <body>
 
  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top">
    <div class="container d-flex align-items-center">
      <h1 class="logo mr-auto"><a href="index.html">Community to hospital predictor</a></h1>
      <nav class="nav-menu d-none d-lg-block">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="disclaimer.html">Disclaimer</a></li>
          <li class="active"><a href="cbc_predictor.html">CBC Predictor</a></li>
          <li><a href="che_predictor.html">EZE Predictor</a></li>
          <li><a href="crp_predictor.html">CRP Predictor</a></li>
        </ul>
      </nav><!-- .nav-menu -->
    </div>
  </header><!-- End Header -->

  <main id="main" style="margin-top: 40px;">

    <!-- ======= About Section ======= -->
    <!-- ======= About Section ======= -->
    <section id="about" class="about">
      <div class="container" data-aos="fade-up">

        <div class="row">
          <div class="col-lg-12 pt-4 pt-lg-0 order-2 order-lg-1 content">
			<div id="panel">
			</div>
          </div>
        </div>
      </div>
    </section><!-- End About Section -->
  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">

    <div class="container d-md-flex py-4">

      <div class="mr-md-auto text-center text-md-left">
        <div class="copyright">
          &copy; Copyright <strong><span>Community to hospital predictor</span></strong>. All Rights Reserved
        </div>
        <div class="credits"> 
          Design and development by <a href="https://teddylazebnik.com/" style="color: #1c1bcf">Teddy Lazebnik</a> and <a href="https://www.linkedin.com/in/adi-shuchami-1a93aa7a/" style="color: #1c1bcf">Adi Shuchami</a>.
        </div>
      </div>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top"><i class="bx bx-up-arrow-alt"></i></a>
  <div id="preloader"></div>
 
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js">
	</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js">
	</script>
	<script crossorigin="anonymous" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" src="https://code.jquery.com/jquery-3.5.1.slim.min.js">
	</script>
	<script crossorigin="anonymous" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js">
	</script>
	<script crossorigin="anonymous" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js">
	</script>
	<script>
	 let name_aki = "CBC";
		let parms_aki = ["ANC", "PLT", "% Neut", "Pain", "Age", "Male", "WBC", "HB"];

generate_forms();

function generate_forms() {
    generate_form(name_aki, "aki_form", parms_aki);
}

function list_to_str(items) {
    let answer = "[";
    for (let i = 0; i < items.length; i++) {
        answer += "'" + items[i] + "',";
    }
    answer = answer.substring(0, answer.length - 1);
    answer += "]";
    return answer;
}

function generate_form(name, form_id, coloums) {
    let panel = document.getElementById("panel");
    panel.innerHTML += '<h3>' + name + ' prediction</h3><div class="card"><div class="card-body"><div id="' + form_id + '" class="row"></div></div></div><br><br>';
    let panel_form = document.getElementById(form_id);
    let form_html = "";
    for (let i = 0; i < coloums.length; i++) {
        form_html += '<div class="col-lg-4 col-md-4 col-sm-12"><div class="form-group">';
        form_html += '<label id="label_' + name + '_' + coloums[i] + '" for="' + coloums[i] + '">' + coloums[i] + ' </label>';
        form_html += '<input type="text" class="form-control" id="' + name + '_' + coloums[i] + '" aria-describedby="' + coloums[i] + '" placeholder="' + coloums[i] + '">';
        form_html += '</div></div>';
    }
    form_html += '<br><div class="col-lg-12 col-md-12 col-sm-12"><button type="submit" class="btn btn-success btn-block" id="predict_btn_' + name + '" onclick="return run_prediction(\'' + name + '\', ' + list_to_str(coloums) +');"> Predict </button></div>';
    form_html += '<br><br><div class="col-lg-10 col-md-10 col-sm-12"><p id="answer_' + name + '"> </p></div>';
    panel_form.innerHTML += form_html;
}

function run_prediction(name, parameters) {
    let values = [];
    let is_broken = false;
    for (let i = 0; i < parameters.length; i++) {
        let new_val = document.getElementById(name + "_" + parameters[i]).value;
        if (new_val == "") {
            document.getElementById("label_" + name + "_" + parameters[i]).style.color = "red";
            if (!is_broken) {
                document.getElementById(name + "_" + parameters[i]).focus();
            }
            is_broken = true;
        } else {
            let float_new_val = parseFloat(new_val);
            if (!isNaN(float_new_val)) {
                values.push(float_new_val);
                document.getElementById("label_" + name + "_" + parameters[i]).style.color = "black";
            } else {
                document.getElementById("label_" + name + "_" + parameters[i]).style.color = "red";
                let input_place = document.getElementById(name + "_" + parameters[i]);
                input_place.value = "";
                input_place.focus();
            }
        }
    }
    if (!is_broken) {
        let predict_with_conf = predict(values);
		let pred_text = "Repeat";
		if (predict_with_conf[0] == 0){
			pred_text = "Do not repeat";
		}
        document.getElementById("answer_" + name).innerHTML = "<h3>The prediction is: <b>" + pred_text + "</b>.<br><br>Because: <br>" + predict_with_conf[1].join(' and <br>') + "</h3>";
    }
}

	function predict(values) {
    let path = [];
    if (values[0] <= 54.05) {
        path.push("ANC <= 54.05");
        if (values[1] <= 89.00) {
            path.push("PLT <= 89.00");
            if (values[3] <= 0.50) {
                path.push("Pain <= 0.50");
                if (values[4] <= 2.49) {
                    path.push("Age <= 2.49");
                    if (values[4] <= 2.39) {
                        path.push("Age <= 2.39");
                        return [1, path];
                    } else {
                        path.push("Age > 2.39");
                        return [0, path];
                    }
                } else {
                    path.push("Age > 2.49");
                    if (values[2] <= 0.31) {
                        path.push("% Neut <= 0.31");
                        return [1, path];
                    } else {
                        path.push("% Neut > 0.31");
                        return [1, path];
                    }
                }
            } else {
                path.push("Pain > 0.50");
                if (values[0] <= 32.65) {
                    path.push("ANC <= 32.65");
                    return [1, path];
                } else {
                    path.push("ANC > 32.65");
                    if (values[0] <= 42.60) {
                        path.push("ANC <= 42.60");
                        return [1, path];
                    } else {
                        path.push("ANC > 42.60");
                        return [1, path];
                    }
                }
            }
        } else {
            path.push("PLT > 89.00");
            if (values[2] <= 2.89) {
                path.push("% Neut <= 2.89");
                if (values[2] <= 0.88) {
                    path.push("% Neut <= 0.88");
                    if (values[5] <= 0.50) {
                        path.push("Male <= 0.50");
                        return [1, path];
                    } else {
                        path.push("Male > 0.50");
                        return [1, path];
                    }
                } else {
                    path.push("% Neut > 0.88");
                    if (values[2] <= 1.01) {
                        path.push("% Neut <= 1.01");
                        return [0, path];
                    } else {
                        path.push("% Neut > 1.01");
                        return [1, path];
                    }
                }
            } else {
                path.push("% Neut > 2.89");
                if (values[4] <= 16.96) {
                    path.push("Age <= 16.96");
                    if (values[2] <= 6.28) {
                        path.push("% Neut <= 6.28");
                        return [1, path];
                    } else {
                        path.push("% Neut > 6.28");
                        return [1, path];
                    }
                } else {
                    path.push("Age > 16.96");
                    if (values[1] <= 288.50) {
                        path.push("PLT <= 288.50");
                        return [1, path];
                    } else {
                        path.push("PLT > 288.50");
                        return [0, path];
                    }
                }
            }
        }
    } else {
        path.push("ANC > 54.05");
        if (values[1] <= 23.50) {
            path.push("PLT <= 23.50");
            if (values[6] <= 7.13) {
                path.push("WBC <= 7.13");
                return [1, path];
            } else {
                path.push("WBC > 7.13");
                if (values[6] <= 7.18) {
                    path.push("WBC <= 7.18");
                    return [0, path];
                } else {
                    path.push("WBC > 7.18");
                    if (values[7] <= 12.95) {
                        path.push("HB <= 12.95");
                        return [1, path];
                    } else {
                        path.push("HB > 12.95");
                        return [1, path];
                    }
                }
            }
        } else {
            path.push("PLT > 23.50");
            if (values[6] <= 5.68) {
                path.push("WBC <= 5.68");
                if (values[1] <= 451.00) {
                    path.push("PLT <= 451.00");
                    if (values[4] <= 6.95) {
                        path.push("Age <= 6.95");
                        return [1, path];
                    } else {
                        path.push("Age > 6.95");
                        return [1, path];
                    }
                } else {
                    path.push("PLT > 451.00");
                    return [0, path];
                }
            } else {
                path.push("WBC > 5.68");
                if (values[0] <= 54.76) {
                    path.push("ANC <= 54.76");
                    if (values[1] <= 479.00) {
                        path.push("PLT <= 479.00");
                        return [0, path];
                    } else {
                        path.push("PLT > 479.00");
                        return [0, path];
                    }
                } else {
                    path.push("ANC > 54.76");
                    if (values[4] <= 6.38) {
                        path.push("Age <= 6.38");
                        return [1, path];
                    } else {
                        path.push("Age > 6.38");
                        return [0, path];
                    }
                }
            }
        }
    }
}
	</script>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/jquery/jquery.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/waypoints/jquery.waypoints.min.js"></script>
  <script src="assets/vendor/counterup/counterup.min.js"></script>
  <script src="assets/vendor/owl.carousel/owl.carousel.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
 </body>
</html>
